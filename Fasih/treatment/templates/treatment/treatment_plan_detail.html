{% extends "specialist/base_specialist.html" %}
{% load static %}

{% block specialist_css %}
<link rel="stylesheet" href="{% static 'css/plan_detail.css' %}">
{% endblock %}

{% block specialist_content %}

<div class="goal-wrapper">
    <div class="goal-card">

        <h1 class="page-title">تفاصيل الخطة العلاجية</h1>

        <!-- معلومات الخطة -->
        <div class="plan-info">
            <p><strong>التشخيص:</strong> {{ plan.diagnosis }}</p>
            <p><strong>وصف المشكلة:</strong> {{ plan.problem_description }}</p>
            <p><strong>الهدف العام:</strong> {{ plan.long_term_goal }}</p>
        </div>

        <!-- زر إضافة هدف -->
        <a href="{% url 'treatment:add_short_term_goal' plan.id %}"
           class="primary-btn">
            إضافة هدف قصير
        </a>

        <!-- عرض الأهداف القصيرة -->
        {% if plan.short_term_goals.all %}
        <ul class="goals-list">
            {% for goal in plan.short_term_goals.all %}
                <li>
                    {{ goal.description }} — {{ goal.target_accuracy }}%
                </li>
            {% endfor %}
        </ul>
        {% endif %}
        <h2>الأيام داخل الخطة</h2>

        <a href="{% url 'treatment:add_daily_plan' plan.id %}" class="primary-btn">
            إضافة يوم
        </a>

        {% if plan.daily_plans.all %}
            {% for day in plan.daily_plans.all %}
                <div class="day-card">
                    <h3>
                        {{ day.day_name }} – {{ day.date }}
                        (الأسبوع {{ day.week_number }})
                    </h3>

                    <p><strong>هدف اليوم:</strong> {{ day.goal_of_day }}</p>

                    <a href="{% url 'treatment:add_daily_task' day.id %}">
                        إضافة مهمة
                    </a>

                    {% if day.tasks.all %}
                        <ul>
                            {% for task in day.tasks.all %}
                                <li>
                                    {{ task.task_name }}
                                    {% if task.status == "COMPLETED" %}
                                        ✅
                                    {% elif task.status == "NOT_COMPLETED" %}
                                        ❌
                                    {% else %}
                                        ⏳
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>لا توجد مهام بعد</p>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <p>لم يتم إضافة أيام بعد</p>
        {% endif %}


    </div>
</div>

{% endblock %}
