{% extends "admin_panel/base_admin.html" %}
{% load static %}

{% block admin_css %}
<link rel="stylesheet" href="{% static 'css/review.css' %}">
{% endblock %}

{% block admin_content %}
<div class="review-wrapper">

    <!-- العنوان -->
    <div class="review-header">
        <h2>مراجعة الأخصائي</h2>
        <p class="sub-text">معلومات الأخصائي والوثائق المرفقة</p>
    </div>

    <!-- معلومات الأخصائي -->
    <div class="review-card">
        <div class="info-grid">
            <div><strong>الاسم:</strong>
                {% if specialist.user.get_full_name %}
                    {{ specialist.user.get_full_name }}
                {% else %}
                    {{ specialist.user.username }}
                {% endif %}
            </div>

            <div><strong>التخصص:</strong> {{ specialist.specialization }}</div>
            <div><strong>رقم الرخصة:</strong> {{ specialist.license_number }}</div>
            <div><strong>سنوات الخبرة:</strong> {{ specialist.years_of_experience }}</div>
            <div>
                <strong>الحالة:</strong>
                <span class="status-badge pending">
                    {{ specialist.get_verification_status_display }}
                </span>
            </div>
        </div>
    </div>

    <!-- الشهادات -->
    <h3 class="section-title">الشهادات</h3>

    <div class="certificates-grid">
        {% for cert in specialist.certificates.all %}
            <div class="certificate-card">
                <div class="cert-info">
                    <h4>{{ cert.title }}</h4>
                    {% if cert.description %}
                        <p>{{ cert.description }}</p>
                    {% endif %}
                    <span class="cert-date">
                        تاريخ الإضافة: {{ cert.added_at|date:"Y-m-d" }}
                    </span>
                </div>

                <div class="cert-actions">
                    <a
                        href="{{ cert.certificate_file.url }}"
                        target="_blank"
                        class="btn btn-outline"
                    >
                        عرض
                    </a>

                    <a
                        href="{{ cert.certificate_file.url }}"
                        download
                        class="btn btn-primary"
                    >
                        تحميل
                    </a>
                </div>
            </div>
        {% empty %}
            <p class="empty-text">لا توجد شهادات مرفقة</p>
        {% endfor %}
    </div>
    <hr class="section-divider">

    <div class="appeals-section">

        <h3 class="section-title">الاعتراضات المقدّمة</h3>

        {% if appeals %}
            {% for appeal in appeals %}
                <div class="appeal-card">

                    <div class="appeal-header">
                        <span class="appeal-date">
                            {{ appeal.created_at|date:"Y-m-d H:i" }}
                        </span>

                        {% if appeal.reviewed %}
                            {% if appeal.accepted %}
                                <span class="status approved">مقبول</span>
                            {% else %}
                                <span class="status rejected">مرفوض</span>
                            {% endif %}
                        {% else %}
                            <span class="status pending">بانتظار المراجعة</span>
                        {% endif %}
                    </div>

                    <div class="appeal-body">
                        <p>{{ appeal.reason }}</p>
                    </div>

                </div>
            {% endfor %}
        {% else %}
            <p class="empty-text">لا توجد اعتراضات مقدّمة.</p>
        {% endif %}

    </div>


    <!-- أزرار القرار -->
    <div class="review-actions">
        <a
            href="{% url 'admin_panel:approve_specialist' specialist.id %}"
            class="btn approve"
            onclick="return confirmApprove();"
        >
            اعتماد
        </a>

        <a
            href="{% url 'admin_panel:reject_specialist' specialist.id %}"
            class="btn reject"
            onclick="return confirmReject();"
        >
            رفض
        </a>
    </div>


</div>
<script>
function confirmApprove() {
    return confirm("هل أنت متأكد من اعتماد هذا الأخصائي؟");
}

function confirmReject() {
    return confirm("هل أنت متأكد من رفض هذا الأخصائي؟");
}
</script>

{% endblock %}
