{% extends "patient/base_patient.html" %}
{% load static %}

{% block title %}ููุญุฉ ุงูุชุญูู{% endblock %}

{% block patient_css %}
<link rel="stylesheet" href="{% static 'css/patient_dashboard.css' %}">
{% endblock %}

{% block patient_content %}

<div class="dashboard-container">

  <div class="dashboard-header">
    <h2>ูุฑุญุจูุง {{ user.get_full_name }}</h2>
    <p>ูุฐู ููุญุฉ ุงูุชุญูู ุงูุฎุงุตุฉ ุจุงููุฑูุถ</p>
  </div>

  <div class="dashboard-grid">

    <!-- ูุงุฑุฏ ุงูููู ุงูุชุนุฑููู -->
    <div class="dashboard-card">
      <div class="card-header">
        <h3>ุงูููู ุงูุชุนุฑููู</h3>
      </div>

      <div class="card-body">
        <ul>
          <li><strong>ุฑูู ุงูููู:</strong> {{ patient.file_number }}</li>
          <li><strong>ุงูุนูุฑ:</strong> {{ patient.age }} ุณููุงุช</li>
          <li><strong>ุงูุฌูุณ:</strong> {{ patient.get_gender_display }}</li>
        </ul>

        <a href="{% url 'patient:profile' %}" class="card-link">
          ุนุฑุถ ุงูููู
        </a>
      </div>
    </div>

    <!-- ูุงุฑุฏ ุญุงูุฉ ุงูุงุณุชุดุงุฑุฉ -->
    <!-- ูุงุฑุฏ ุญุงูุฉ ุงูุงุณุชุดุงุฑุฉ -->
    <div class="dashboard-card">
      <div class="card-header">
        <h3>ุญุงูุฉ ุงูุงุณุชุดุงุฑุฉ</h3>
      </div>

      <div class="card-body">

        {% if assessment %}

          {% if assessment.status == "PENDING" %}
            <p class="status pending">
              โณ ุงุณุชุดุงุฑุชู ููุฏ ุงููุฑุงุฌุนุฉ
            </p>
            <span class="hint">
              ุณูููู ุงูุฃุฎุตุงุฆู ุจูุฑุงุฌุนุฉ ุงูุงุณุชุจูุงู ูุฑูุจูุง
            </span>

          {% elif assessment.status == "ACCEPTED" %}
            <p class="status accepted">
              โ ุชู ูุจูู ุงูุงุณุชุดุงุฑุฉ
            </p>
            <span class="hint">
              ุณูุชู ุชุญุฏูุฏ ุงูุฌูุณุฉ ุงูุงุณุชุดุงุฑูุฉ ุงูุฃููู
            </span>

          {% elif assessment.status == "REJECTED" %}
            <p class="status rejected">
              โ ุชู ุฑูุถ ุงูุงุณุชุดุงุฑุฉ
            </p>

            {% if assessment.rejection_reason %}
              <span class="hint">
                ุงูุณุจุจ: {{ assessment.get_rejection_reason_display }}
              </span>
            {% endif %}

          {% endif %}

        {% else %}
          <p class="muted">
            ูู ูุชู ุทูุจ ุงุณุชุดุงุฑุฉ ุจุนุฏ
          </p>

          <a href="{% url 'specialist:choose_specialist' %}" class="card-link">
            ุทูุจ ุงุณุชุดุงุฑุฉ
          </a>
        {% endif %}

      </div>
    </div>

    <!-- ูุงุฑุฏ ููุงูู ุงูููู -->
    <div class="dashboard-card">
      <div class="card-header">
        <h3>ููุงูู ุงูููู</h3>
      </div>

      <div class="card-body">
        {% if today_tasks_count > 0 %}
          <p>
            ูุฏูู <strong>{{ today_tasks_count }}</strong> ููุงู ููููู
          </p>

          <a href="{% url 'tasks:daily_tasks' %}" class="card-link">
            ุนุฑุถ ุงูููุงู
          </a>
        {% else %}
          <p class="muted">ูุง ุชูุฌุฏ ููุงู ุงูููู</p>
          <span class="hint">ุณูููู ุงูุฃุฎุตุงุฆู ุจุฅุถุงูุฉ ุงูููุงู ุนูุฏ ุจุฏุก ุงูุฎุทุฉ</span>
        {% endif %}
      </div>
    </div>

    <!-- ูุงุฑุฏ ุฌูุณุงุชู -->
    <div class="dashboard-card
      {% if next_session and not next_session.can_join %}
        session-upcoming
      {% endif %}
    ">
      <div class="card-header">
        <h3>ุฌูุณุงุชู</h3>
      </div>

      <div class="card-body">
        {% if not has_sessions %}
          <p class="muted">ูุง ุชูุฌุฏ ุฌูุณุงุช ูุฌุฏููุฉ ุญุงูููุง</p>
          <span class="hint">ุณูููู ุงูุฃุฎุตุงุฆู ุจุฌุฏููุฉ ุงูุฌูุณุงุช ูุงุญููุง</span>

        {% elif next_session and not next_session.can_join %}
          <p>ูุฏูู ุฌูุณุฉ ูุงุฏูุฉ</p>
          <p class="muted">๐ {{ next_session.start_time }}</p>

          <a href="{% url 'patient:sessions' %}" class="card-link">
            ุนุฑุถ ุงูุฌูุณุงุช
          </a>

        {% elif next_session and next_session.can_join %}
          <p>ุฌูุณุฉ ุฌุงุฑูุฉ ุงูุขู</p>

          <a href="{% url 'session:join_session' next_session.id %}"
             class="card-link">
            ุฏุฎูู ุงูุฌูุณุฉ
          </a>
        {% endif %}
      </div>
    </div>
    <div class="dashboard-card">
      <div class="card-header">
        <h3>ุงูุฎุทุฉ ุงูุนูุงุฌูุฉ</h3>
      </div>

      <div class="card-body">
        {% if treatment_plan %}
          <p>ุงูุญุงูุฉ: {{ treatment_plan.get_status_display }}</p>

          <a href="{% url 'patient:treatment_plan' %}" class="card-link">
            ุนุฑุถ ุงูุฎุทุฉ
          </a>
        {% else %}
          <p class="muted">ูุง ุชูุฌุฏ ุฎุทุฉ ุนูุงุฌูุฉ ุจุนุฏ</p>
        {% endif %}
      </div>
    </div>


  </div>
</div>

{% endblock %}
