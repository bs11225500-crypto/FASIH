{% extends "patient/base_patient.html" %}
{% load static %}

{% block title %}ุฌูุณุงุชู{% endblock %}

{% block patient_css %}
<link rel="stylesheet" href="{% static 'css/patient_sessions.css' %}">
{% endblock %}

{% block patient_content %}

<div class="sessions-container">

{% if not pending_sessions and not confirmed_sessions %}

  <!-- Empty State -->
  <div class="empty-state">
    <h3>ูุง ุชูุฌุฏ ุฌูุณุงุช ุญุงูููุง</h3>

    {% if not has_specialist %}
      <p class="muted">
        ูู ุชูู ุจุงุฎุชูุงุฑ ุฃุฎุตุงุฆู ุจุนุฏ.<br>
        ูุฑุฌู ุงุฎุชูุงุฑ ุฃุฎุตุงุฆู ูุทูุจ ุฌูุณุฉ ุงุณุชุดุงุฑุฉ ูุฌุงููุฉ.
      </p>

    {% elif not has_completed_initial_session %}
      <p class="muted">
        ูุง ุชูุฌุฏ ุฌูุณุงุช ุญุงูููุง.<br>
        ุณุชุธูุฑ ุฌูุณุฉ ุงูุงุณุชุดุงุฑุฉ ุงููุฌุงููุฉ ุจุนุฏ ููุงููุฉ ุงูุฃุฎุตุงุฆู.
      </p>

    {% else %}
      <p class="muted">
        ุชู ุงูุงูุชูุงุก ูู ุฌูุณุฉ ุงูุงุณุชุดุงุฑุฉ.<br>
        ุณุชุธูุฑ ุงูุฌูุณุงุช ุงูุนูุงุฌูุฉ ุจุนุฏ ุงุนุชูุงุฏ ุงูุฎุทุฉ ุงูุนูุงุฌูุฉ ูุงูุฏูุน.
      </p>
    {% endif %}

  </div>

{% else %}

  <div class="page-header">
    <h2>ุฌูุณุงุชู</h2>
    <p>ุนุฑุถ ุฌููุน ุงูุฌูุณุงุช ุงููุฌุฏููุฉ ูู</p>
  </div>

  <!-- ุฌูุณุงุช ุจุงูุชุธุงุฑ ุงูููุงููุฉ -->
  <section class="sessions-section">
    <h3>ุฌูุณุงุช ุจุงูุชุธุงุฑ ููุงููุชู</h3>

    {% if pending_sessions %}
      {% for session in pending_sessions %}
        <div class="session-card pending">
          <h4>{{ session.title }}</h4>
          <p>๐ {{ session.start_time }}</p>

          <form method="post" action="{% url 'session:respond_session' session.id %}">
            {% csrf_token %}
            <button name="action" value="accept" class="btn-success">
              ุฃูุงูู
            </button>
          </form>

          <form method="post" action="{% url 'session:respond_session' session.id %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="reject">

            <textarea name="reason" placeholder="ุณุจุจ ุงูุฑูุถ"></textarea>
            <textarea name="suggested_times" placeholder="ุฃููุงุช ุชูุงุณุจู"></textarea>

            <button type="submit" class="btn-danger">
              ูุง ููุงุณุจูู
            </button>
          </form>
        </div>
      {% endfor %}
    {% else %}
      <p class="muted">ูุง ุชูุฌุฏ ุฌูุณุงุช ุจุงูุชุธุงุฑ ุงูููุงููุฉ.</p>
    {% endif %}
  </section>

  <!-- ุฌูุณุงุช ูุคูุฏุฉ -->
  <section class="sessions-section">
    <h3>ุงูุฌูุณุงุช ุงููุคูุฏุฉ</h3>

    {% if confirmed_sessions %}
      {% for session in confirmed_sessions %}
        <div class="session-card confirmed">
          <h4>{{ session.title }}</h4>
          <p> {{ session.start_time }}</p>

          {% if session.can_join %}
            <a href="{% url 'session:join_session' session.id %}" class="btn-primary">
              ุฏุฎูู ุงูุฌูุณุฉ
            </a>
          {% else %}
            <span class="muted">โณ ูู ูุญู ููุช ุงูุฌูุณุฉ ุจุนุฏ</span>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      <p class="muted">ูุง ุชูุฌุฏ ุฌูุณุงุช ูุคูุฏุฉ ุญุงูููุง.</p>
    {% endif %}
  </section>

{% endif %}

</div>

{% endblock %}
